{% extends 'base.html' %} 

{% load static %}

{% block headers %}
<style>
    .progress-vertical-container {
        position: -webkit-sticky;
        position: sticky;
        top: 20px;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .progress-vertical {
        width: 60px;
        height: 100%;
        background-color: #e9ecef;
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        margin-top: 50px;
    }

    .progress-bar {
        width: 100%;
        background-color: #007bff;
        transition: height 0.3s ease;
    }

    .progress-indicators {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding-top: 10px;
        padding-bottom: 10px;
    }

    .progress-indicators .progress-percent {
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
    }

    

</style>
{% endblock headers %}

{% block content %}
<section class="content">
    <div class="row">
        <!-- Headline and Subheadline -->
        <div class="col-xl-9 col-12">
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="display-4 mb-4">Breast Cancer Risk Assessment Questionnaire</h1>
                    <p class="lead mb-5 text-muted">
                        Please answer the following questions to help us assess your risk for breast cancer.
                    </p>
                </div>
            </div>

            <!-- Questionnaire Form -->
            <div class="row">
                <form id="questionnaireForm" method="post" action="{% url 'questionnaire' %}">
                    {% csrf_token %}
                    <div class="row">
                        {% for question, key, value in form.questions %}
                            <div class="col-md-6 mb-4">
                                <div class="box">
                                    <div class="box-header">
                                        <h4 class="box-title">{{ question }}</h4>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="id_{{ key }}" name="{{ key }}" data-value="{{ value }}">
                                            <label class="form-check-label" for="id_{{ key }}">Yes</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="checkbox">
                                <input type="checkbox" id="basic_checkbox_1">
                                <label for="basic_checkbox_1">I consent to my 
                                    <a href="#" class="text-primary">data being used for the purpose of this assessment and understand the privacy policy.
                                    </a>
                                </label>
                            </div>
                        </div>
                        <div class="col-12 text-center">
                            <button type="submit" class="waves-effect waves-light btn btn-primary w-p100 mt-10">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Progress Indicator -->
        <div class="col-xl-3 col-12">
            <div class="progress-vertical-container">
                <div class="progress-vertical">
                    <div class="progress-bar bg-primary progress-bar-striped progress-bar-animated" role="progressbar" aria-valuemin="0" style="height: 0%;" id="progressBar"></div>
                </div>
                <div class="progress-indicators">
                    <span class="progress-percent">0%</span>
                    <span class="progress-percent">25%</span>
                    <span class="progress-percent">50%</span>
                    <span class="progress-percent">75%</span>
                    <span class="progress-percent">100%</span>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Total possible score based on sum of all values
        let totalPossibleScore = 0;
        $('#questionnaireForm .form-check-input').each(function() {
            totalPossibleScore += parseFloat($(this).data('value'));
        });

        function updateProgressBar() {
            let currentScore = 0;
            $('#questionnaireForm .form-check-input:checked').each(function() {
                currentScore += parseFloat($(this).data('value'));
            });

            let progress = (currentScore / totalPossibleScore) * 100;
            $('#progressBar').css('height', progress + '%');
        }

        $('#questionnaireForm .form-check-input').on('change', function() {
            updateProgressBar();
        });

        // Initial update
        updateProgressBar();
    });
</script>
{% endblock scripts %}
